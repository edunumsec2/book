\usepackage{listings}
\usepackage{listingsutf8}
\usepackage{pifont}

%\usepackage{animate}
\newcommand{\insertvideo}[3]{\begin{flushright}\fbox{Vidéo #3: \sphinxurl{#2}  \includegraphics[scale=0.3]{#1}}\end{flushright}}
\newcommand{\insertsolution}[1]{\flushright \rotatebox[origin=c]{180}{\textit{Réponse: #1}}}
\newcommand{\glossaryterm}[1]{\textit{#1}}
\newcommand{\glossarylist}{\\}
\renewenvironment{wrapfigure}[2]{\begin{figure}[htbp]}{\end{figure} \ignorespacesafterend}
\newenvironment{timeline}{}{}
\newenvironment{timelineitem}[2]{}{}


%% \newenvironment{timeline}{\begin{tabular}{rl}}{\end{tabular}}
%% \newenvironment{timelineitem}[2]{\textbf{#1} & \textbf{#2} \\ &}{\\}
\sphinxpxdimen=.5bp\relax

\definecolor{light-gray}{gray}{0.95} 
\lstset{language=Python,upquote=true,showstringspaces=false,columns=fullflexible, basicstyle = \ttfamily,backgroundcolor = \color{light-gray},numbers=right,stepnumber=1,keywordstyle=\color{blue},stringstyle=\color{magenta},commentstyle=\color{red},breaklines=true}
%% for accented characters in lstlisting
\lstset{inputencoding=utf8/latin1, literate=%
         {à}{{\`a }}1
         {â}{{\^a }}1
         {é}{{\'e}}1
         {è}{{\`e}}1
         {ê}{{\^e}}1
         {ô}{{\^o}}1
         {’}{{'}}1
         {ù}{{\`u}}1
         {û}{{\^u}}1
         {À}{{\`A}}1
         {♣}{{\ding{168}}}1
         {♦}{{\ding{169}}}1
         {♥}{{\ding{170}}}1
         {♠}{{\ding{171}}}1
}

%% undefined unicode characters
\DeclareUnicodeCharacter{270F}{}
\DeclareUnicodeCharacter{FE0F}{}
\DeclareUnicodeCharacter{1F4D2}{}
\DeclareUnicodeCharacter{1F50C}{}
\DeclareUnicodeCharacter{1F1E7}{}
\DeclareUnicodeCharacter{1F1EB}{}
\DeclareUnicodeCharacter{1F1EC}{}
\DeclareUnicodeCharacter{1F1EE}{}
\DeclareUnicodeCharacter{1F1F1}{}
\DeclareUnicodeCharacter{1F1F3}{}
\DeclareUnicodeCharacter{1F1FA}{}
\DeclareUnicodeCharacter{1F1F8}{}
\DeclareUnicodeCharacter{1F1FF}{}
\DeclareUnicodeCharacter{2009}{}
\DeclareUnicodeCharacter{200A}{}
\DeclareUnicodeCharacter{202F}{}
\DeclareUnicodeCharacter{300}{è}
\DeclareUnicodeCharacter{301}{é}
\DeclareUnicodeCharacter{302}{ê}
\DeclareUnicodeCharacter{03B1}{$\alpha$}
\DeclareUnicodeCharacter{03B2}{$\beta$}
\DeclareUnicodeCharacter{03B3}{$\gamma$}
\DeclareUnicodeCharacter{03B4}{$\delta$}
\DeclareUnicodeCharacter{03B5}{$\epsilon$}
\DeclareUnicodeCharacter{03B7}{$\eta$}
\DeclareUnicodeCharacter{03B9}{$\iota$}
\DeclareUnicodeCharacter{03BB}{$\lambda$}
\DeclareUnicodeCharacter{03BD}{$\nu$}
\DeclareUnicodeCharacter{03C1}{$\rho$}
\DeclareUnicodeCharacter{03C4}{$\tau$}
\DeclareUnicodeCharacter{03C6}{$\phi$}

%% new maketitle
\makeatletter
\renewcommand*{\maketitle}{%
\begin{titlepage}
 \centering
 \resizebox{\textwidth}{!}{\includegraphics{modulo-head-banner.png}}\\
 \vspace*{\fill}
 {\Huge  \@title}\\
 \vspace*{3cm}
{\raggedleft\Large\@author}\\
 \vspace*{3cm}
%{\raggedleft\Large\the\day.\the\month.\the\year}
{\raggedleft\Large \@date}
 \vspace*{\fill}\\
 \includegraphics[scale=0.5]{by-nc.eu.png}
\end{titlepage}
}
\makeatother

%% display cards
%\newenvironment{card}{\begin{minipage}{0.5\textwidth}}{\end{minipage}}
\makeatletter
\def\@cardenvironment{minipage}
\def\@tabenvironment{framed}
\renewenvironment{sphinxuseclass}[1]{%
\def\myarg{#1}
\def\cardenv{col-sm-6}
\def\tabenv{tabbed-container}
\ifx\myarg\cardenv\begin{minipage}{0.5\textwidth}\fi
%\ifx\myarg\tabenv\begin{framed}\fi
\ifx\myarg\tabenv\centering\begin{minipage}{0.5\textwidth}\begin{framed}\fi
}%
{%
\ifx\@currenvir\@cardenvironment\end{minipage}\fi
\ifx\@currenvir\@tabenvironment\end{framed}\end{minipage}\fi
%\vspace{0.5cm}
}
\makeatother

%% personalizing headers and footers (e,g, removing version number)

\makeatletter
   \fancypagestyle{normal}{
    \fancyhf{}
    \fancyfoot[RO]{{\py@HeaderFamily\thepage}}
    \fancyfoot[LO]{{\py@HeaderFamily\nouppercase{\rightmark}}}
    \fancyhead[RO]{{\py@HeaderFamily \@title}}
    \if@twoside
     \fancyfoot[LE]{{\py@HeaderFamily\thepage}}
     \fancyfoot[RE]{{\py@HeaderFamily\nouppercase{\leftmark}}}
     \fancyhead[LE]{{\py@HeaderFamily \@title}}
    \fi
    \renewcommand{\headrulewidth}{0.4pt}
    \renewcommand{\footrulewidth}{0.4pt}
    % define chaptermark with \@chappos when \@chappos is available for Japanese
    \ltx@ifundefined{@chappos}{}
      {\def\chaptermark##1{\markboth{\@chapapp\space\thechapter\space\@chappos\space ##1}{}}}
    }
  % Update the plain style so we get the page number & footer line,
  % but not a chapter or section title.  This is to keep the first
  % page of a chapter `clean.'
   \fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[RO]{{\py@HeaderFamily\thepage}}
    \if@twoside\fancyfoot[LE]{{\py@HeaderFamily\thepage}}\fi
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0.4pt}
    }
\makeatother

%%%% in the fly image conversion taken from here: https://tex.stackexchange.com/questions/574562/inclusion-of-graphics-with-on-the-fly-conversion-using-xetex

\usepackage{graphicx}% including pictures
\usepackage{shellesc}% run system commands from TeX engine
\usepackage{etoolbox}% for \csdef, \csletcs
\makeatletter
\def\@firstofthree#1#2#3{#1}%
\def\@secondofthree#1#2#3{#2}%
\newcommand{\DeclareGraphicsAlien}[2]{%
  \edef\Gin@extensions{#1,\Gin@extensions}%
  \DeclareGraphicsRule{#1}{\@gobble#1}{#1}{}%
  \csdef{Gread@\@gobble#1}##1{%
    \edef\SourceFile{\Gin@base\Gin@ext}%
%    \edef\Gin@base{\Gin@base-\@gobble#1-converted-to}%
%    \edef\Gin@base{\Gin@base-\@gobble#1-converted-to}%
    \edef\Gin@ext{#2}%
    \edef\OutputFile{\Gin@base\Gin@ext}%
    \edef\targetfmt{\expandafter\expandafter\expandafter
                    \@firstofthree\csname Gin@rule@\Gin@ext\endcsname\relax}%
    \edef\targetext{\expandafter\expandafter\expandafter
                    \@secondofthree\csname Gin@rule@\Gin@ext\endcsname\relax}%
    %\IfFileExists{\SourceFile}{\ShellEscape{#3}}{}%
    \csletcs{Ginclude@\@gobble#1}{Ginclude@\targetfmt}%
    \csname Gread@\targetfmt\endcsname{\Gin@base\targetext}%
  }%
}%
\makeatother

%%% this needs to be made generalizable

\DeclareGraphicsAlien{.gif}{.pdf}
\DeclareGraphicsAlien{.svg}{.pdf}
